{
  "url": "https://react.dev/learn/react-compiler/incremental-adoption",
  "title": "Incremental Adoption",
  "content": "React Compiler can be adopted incrementally, allowing you to try it on specific parts of your codebase first. This guide shows you how to gradually roll out the compiler in existing projects.\n\nReact Compiler is designed to optimize your entire codebase automatically, but you don’t have to adopt it all at once. Incremental adoption gives you control over the rollout process, letting you test the compiler on small parts of your app before expanding to the rest.\n\nStarting small helps you build confidence in the compiler’s optimizations. You can verify that your app behaves correctly with compiled code, measure performance improvements, and identify any edge cases specific to your codebase. This approach is especially valuable for production applications where stability is critical.\n\nIncremental adoption also makes it easier to address any Rules of React violations the compiler might find. Instead of fixing violations across your entire codebase at once, you can tackle them systematically as you expand compiler coverage. This keeps the migration manageable and reduces the risk of introducing bugs.\n\nBy controlling which parts of your code get compiled, you can also run A/B tests to measure the real-world impact of the compiler’s optimizations. This data helps you make informed decisions about full adoption and demonstrates the value to your team.\n\nThere are three main approaches to adopt React Compiler incrementally:\n\nAll approaches allow you to test the compiler on specific parts of your application before full rollout.\n\nBabel’s overrides option lets you apply different plugins to different parts of your codebase. This is ideal for gradually adopting React Compiler directory by directory.\n\nStart by applying the compiler to a specific directory:\n\nAs you gain confidence, add more directories:\n\nYou can also configure compiler options per override:\n\nFor maximum control, you can use compilationMode: 'annotation' to only compile components and hooks that explicitly opt in with the \"use memo\" directive.\n\nThis approach gives you fine-grained control over individual components and hooks. It’s useful when you want to test the compiler on specific components without affecting entire directories.\n\nAdd \"use memo\" at the beginning of functions you want to compile:\n\nWith compilationMode: 'annotation', you must:\n\nThis gives you precise control over which components are compiled while you evaluate the compiler’s impact.\n\nThe gating option enables you to control compilation at runtime using feature flags. This is useful for running A/B tests or gradually rolling out the compiler based on user segments.\n\nThe compiler wraps optimized code in a runtime check. If the gate returns true, the optimized version runs. Otherwise, the original code runs.\n\nCreate a module that exports your gating function:\n\nIf you encounter issues during adoption:",
  "headings": [
    {
      "level": "h1",
      "text": "Incremental Adoption",
      "id": ""
    },
    {
      "level": "h3",
      "text": "You will learn",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Why Incremental Adoption?",
      "id": "why-incremental-adoption"
    },
    {
      "level": "h2",
      "text": "Approaches to Incremental Adoption",
      "id": "approaches-to-incremental-adoption"
    },
    {
      "level": "h2",
      "text": "Directory-Based Adoption with Babel Overrides",
      "id": "directory-based-adoption"
    },
    {
      "level": "h3",
      "text": "Basic Configuration",
      "id": "basic-configuration"
    },
    {
      "level": "h3",
      "text": "Expanding Coverage",
      "id": "expanding-coverage"
    },
    {
      "level": "h3",
      "text": "With Compiler Options",
      "id": "with-compiler-options"
    },
    {
      "level": "h2",
      "text": "Opt-in Mode with “use memo”",
      "id": "opt-in-mode-with-use-memo"
    },
    {
      "level": "h3",
      "text": "Note",
      "id": ""
    },
    {
      "level": "h3",
      "text": "Annotation Mode Configuration",
      "id": "annotation-mode-configuration"
    },
    {
      "level": "h3",
      "text": "Using the Directive",
      "id": "using-the-directive"
    },
    {
      "level": "h2",
      "text": "Runtime Feature Flags with Gating",
      "id": "runtime-feature-flags-with-gating"
    },
    {
      "level": "h3",
      "text": "How Gating Works",
      "id": "how-gating-works"
    },
    {
      "level": "h3",
      "text": "Gating Configuration",
      "id": "gating-configuration"
    },
    {
      "level": "h3",
      "text": "Implementing the Feature Flag",
      "id": "implementing-the-feature-flag"
    },
    {
      "level": "h2",
      "text": "Troubleshooting Adoption",
      "id": "troubleshooting-adoption"
    },
    {
      "level": "h2",
      "text": "Next Steps",
      "id": "next-steps"
    }
  ],
  "code_samples": [
    {
      "code": "// babel.config.jsmodule.exports = {  plugins: [    // Global plugins that apply to all files  ],  overrides: [    {      test: './src/modern/**/*.{js,jsx,ts,tsx}',      plugins: [        'babel-plugin-react-compiler'      ]    }  ]};",
      "language": "unknown"
    },
    {
      "code": "// babel.config.jsmodule.exports = {  plugins: [    // Global plugins  ],  overrides: [    {      test: ['./src/modern/**/*.{js,jsx,ts,tsx}', './src/features/**/*.{js,jsx,ts,tsx}'],      plugins: [        'babel-plugin-react-compiler'      ]    },    {      test: './src/legacy/**/*.{js,jsx,ts,tsx}',      plugins: [        // Different plugins for legacy code      ]    }  ]};",
      "language": "unknown"
    },
    {
      "code": "// babel.config.jsmodule.exports = {  plugins: [],  overrides: [    {      test: './src/experimental/**/*.{js,jsx,ts,tsx}',      plugins: [        ['babel-plugin-react-compiler', {          // options ...        }]      ]    },    {      test: './src/production/**/*.{js,jsx,ts,tsx}',      plugins: [        ['babel-plugin-react-compiler', {          // options ...        }]      ]    }  ]};",
      "language": "unknown"
    },
    {
      "code": "// babel.config.jsmodule.exports = {  plugins: [    ['babel-plugin-react-compiler', {      compilationMode: 'annotation',    }],  ],};",
      "language": "unknown"
    },
    {
      "code": "function TodoList({ todos }) {  \"use memo\"; // Opt this component into compilation  const sortedTodos = todos.slice().sort();  return (    <ul>      {sortedTodos.map(todo => (        <TodoItem key={todo.id} todo={todo} />      ))}    </ul>  );}function useSortedData(data) {  \"use memo\"; // Opt this hook into compilation  return data.slice().sort();}",
      "language": "javascript"
    },
    {
      "code": "// babel.config.jsmodule.exports = {  plugins: [    ['babel-plugin-react-compiler', {      gating: {        source: 'ReactCompilerFeatureFlags',        importSpecifierName: 'isCompilerEnabled',      },    }],  ],};",
      "language": "unknown"
    },
    {
      "code": "// ReactCompilerFeatureFlags.jsexport function isCompilerEnabled() {  // Use your feature flag system  return getFeatureFlag('react-compiler-enabled');}",
      "language": "unknown"
    }
  ],
  "patterns": [],
  "links": [
    "https://react.dev/learn",
    "https://react.dev/learn/react-compiler",
    "https://react.dev/learn/react-compiler/incremental-adoption",
    "https://react.dev/learn/react-compiler/debugging",
    "https://react.dev/reference/react-compiler/configuration",
    "https://react.dev/learn/react-compiler/installation"
  ]
}