{
  "url": "https://fastapi.tiangolo.com/advanced/custom-response/",
  "title": "Custom Response - HTML, Stream, File, othersÂ¶",
  "content": "By default, FastAPI will return the responses using JSONResponse.\n\nYou can override it by returning a Response directly as seen in Return a Response directly.\n\nBut if you return a Response directly (or any subclass, like JSONResponse), the data won't be automatically converted (even if you declare a response_model), and the documentation won't be automatically generated (for example, including the specific \"media type\", in the HTTP header Content-Type as part of the generated OpenAPI).\n\nBut you can also declare the Response that you want to be used (e.g. any Response subclass), in the path operation decorator using the response_class parameter.\n\nThe contents that you return from your path operation function will be put inside of that Response.\n\nAnd if that Response has a JSON media type (application/json), like is the case with the JSONResponse and UJSONResponse, the data you return will be automatically converted (and filtered) with any Pydantic response_model that you declared in the path operation decorator.\n\nIf you use a response class with no media type, FastAPI will expect your response to have no content, so it will not document the response format in its generated OpenAPI docs.\n\nFor example, if you are squeezing performance, you can install and use orjson and set the response to be ORJSONResponse.\n\nImport the Response class (sub-class) you want to use and declare it in the path operation decorator.\n\nFor large responses, returning a Response directly is much faster than returning a dictionary.\n\nThis is because by default, FastAPI will inspect every item inside and make sure it is serializable as JSON, using the same JSON Compatible Encoder explained in the tutorial. This is what allows you to return arbitrary objects, for example database models.\n\nBut if you are certain that the content that you are returning is serializable with JSON, you can pass it directly to the response class and avoid the extra overhead that FastAPI would have by passing your return content through the jsonable_encoder before passing it to the response class.\n\nThe parameter response_class will also be used to define the \"media type\" of the response.\n\nIn this case, the HTTP header Content-Type will be set to application/json.\n\nAnd it will be documented as such in OpenAPI.\n\nThe ORJSONResponse is only available in FastAPI, not in Starlette.\n\nTo return a response with HTML directly from FastAPI, use HTMLResponse.\n\nThe parameter response_class will also be used to define the \"media type\" of the response.\n\nIn this case, the HTTP header Content-Type will be set to text/html.\n\nAnd it will be documented as such in OpenAPI.\n\nAs seen in Return a Response directly, you can also override the response directly in your path operation, by returning it.\n\nThe same example from above, returning an HTMLResponse, could look like:\n\nA Response returned directly by your path operation function won't be documented in OpenAPI (for example, the Content-Type won't be documented) and won't be visible in the automatic interactive docs.\n\nOf course, the actual Content-Type header, status code, etc, will come from the Response object you returned.\n\nIf you want to override the response from inside of the function but at the same time document the \"media type\" in OpenAPI, you can use the response_class parameter AND return a Response object.\n\nThe response_class will then be used only to document the OpenAPI path operation, but your Response will be used as is.\n\nFor example, it could be something like:\n\nIn this example, the function generate_html_response() already generates and returns a Response instead of returning the HTML in a str.\n\nBy returning the result of calling generate_html_response(), you are already returning a Response that will override the default FastAPI behavior.\n\nBut as you passed the HTMLResponse in the response_class too, FastAPI will know how to document it in OpenAPI and the interactive docs as HTML with text/html:\n\nHere are some of the available responses.\n\nKeep in mind that you can use Response to return anything else, or even create a custom sub-class.\n\nYou could also use from starlette.responses import HTMLResponse.\n\nFastAPI provides the same starlette.responses as fastapi.responses just as a convenience for you, the developer. But most of the available responses come directly from Starlette.\n\nThe main Response class, all the other responses inherit from it.\n\nYou can return it directly.\n\nIt accepts the following parameters:\n\nFastAPI (actually Starlette) will automatically include a Content-Length header. It will also include a Content-Type header, based on the media_type and appending a charset for text types.\n\nTakes some text or bytes and returns an HTML response, as you read above.\n\nTakes some text or bytes and returns a plain text response.\n\nTakes some data and returns an application/json encoded response.\n\nThis is the default response used in FastAPI, as you read above.\n\nA fast alternative JSON response using orjson, as you read above.\n\nThis requires installing orjson for example with pip install orjson.\n\nAn alternative JSON response using ujson.\n\nThis requires installing ujson for example with pip install ujson.\n\nujson is less careful than Python's built-in implementation in how it handles some edge-cases.\n\nIt's possible that ORJSONResponse might be a faster alternative.\n\nReturns an HTTP redirect. Uses a 307 status code (Temporary Redirect) by default.\n\nYou can return a RedirectResponse directly:\n\nOr you can use it in the response_class parameter:\n\nIf you do that, then you can return the URL directly from your path operation function.\n\nIn this case, the status_code used will be the default one for the RedirectResponse, which is 307.\n\nYou can also use the status_code parameter combined with the response_class parameter:\n\nTakes an async generator or a normal generator/iterator and streams the response body.\n\nIf you have a file-like object (e.g. the object returned by open()), you can create a generator function to iterate over that file-like object.\n\nThat way, you don't have to read it all first in memory, and you can pass that generator function to the StreamingResponse, and return it.\n\nThis includes many libraries to interact with cloud storage, video processing, and others.\n\nThis yield from tells the function to iterate over that thing named file_like. And then, for each part iterated, yield that part as coming from this generator function (iterfile).\n\nSo, it is a generator function that transfers the \"generating\" work to something else internally.\n\nBy doing it this way, we can put it in a with block, and that way, ensure that the file-like object is closed after finishing.\n\nNotice that here as we are using standard open() that doesn't support async and await, we declare the path operation with normal def.\n\nAsynchronously streams a file as the response.\n\nTakes a different set of arguments to instantiate than the other response types:\n\nFile responses will include appropriate Content-Length, Last-Modified and ETag headers.\n\nYou can also use the response_class parameter:\n\nIn this case, you can return the file path directly from your path operation function.\n\nYou can create your own custom response class, inheriting from Response and using it.\n\nFor example, let's say that you want to use orjson, but with some custom settings not used in the included ORJSONResponse class.\n\nLet's say you want it to return indented and formatted JSON, so you want to use the orjson option orjson.OPT_INDENT_2.\n\nYou could create a CustomORJSONResponse. The main thing you have to do is create a Response.render(content) method that returns the content as bytes:\n\nNow instead of returning:\n\n...this response will return:\n\nOf course, you will probably find much better ways to take advantage of this than formatting JSON. ðŸ˜‰\n\nWhen creating a FastAPI class instance or an APIRouter you can specify which response class to use by default.\n\nThe parameter that defines this is default_response_class.\n\nIn the example below, FastAPI will use ORJSONResponse by default, in all path operations, instead of JSONResponse.\n\nYou can still override response_class in path operations as before.\n\nYou can also declare the media type and many other details in OpenAPI using responses: Additional Responses in OpenAPI.",
  "headings": [
    {
      "level": "h1",
      "text": "Custom Response - HTML, Stream, File, othersÂ¶",
      "id": "custom-response-html-stream-file-others"
    },
    {
      "level": "h2",
      "text": "Use ORJSONResponseÂ¶",
      "id": "use-orjsonresponse"
    },
    {
      "level": "h2",
      "text": "HTML ResponseÂ¶",
      "id": "html-response"
    },
    {
      "level": "h3",
      "text": "Return a ResponseÂ¶",
      "id": "return-a-response"
    },
    {
      "level": "h3",
      "text": "Document in OpenAPI and override ResponseÂ¶",
      "id": "document-in-openapi-and-override-response"
    },
    {
      "level": "h4",
      "text": "Return an HTMLResponse directlyÂ¶",
      "id": "return-an-htmlresponse-directly"
    },
    {
      "level": "h2",
      "text": "Available responsesÂ¶",
      "id": "available-responses"
    },
    {
      "level": "h3",
      "text": "ResponseÂ¶",
      "id": "response"
    },
    {
      "level": "h3",
      "text": "HTMLResponseÂ¶",
      "id": "htmlresponse"
    },
    {
      "level": "h3",
      "text": "PlainTextResponseÂ¶",
      "id": "plaintextresponse"
    },
    {
      "level": "h3",
      "text": "JSONResponseÂ¶",
      "id": "jsonresponse"
    },
    {
      "level": "h3",
      "text": "ORJSONResponseÂ¶",
      "id": "orjsonresponse"
    },
    {
      "level": "h3",
      "text": "UJSONResponseÂ¶",
      "id": "ujsonresponse"
    },
    {
      "level": "h3",
      "text": "RedirectResponseÂ¶",
      "id": "redirectresponse"
    },
    {
      "level": "h3",
      "text": "StreamingResponseÂ¶",
      "id": "streamingresponse"
    },
    {
      "level": "h4",
      "text": "Using StreamingResponse with file-like objectsÂ¶",
      "id": "using-streamingresponse-with-file-like-objects"
    },
    {
      "level": "h3",
      "text": "FileResponseÂ¶",
      "id": "fileresponse"
    },
    {
      "level": "h2",
      "text": "Custom response classÂ¶",
      "id": "custom-response-class"
    },
    {
      "level": "h2",
      "text": "Default response classÂ¶",
      "id": "default-response-class"
    },
    {
      "level": "h2",
      "text": "Additional documentationÂ¶",
      "id": "additional-documentation"
    }
  ],
  "code_samples": [
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import ORJSONResponse\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=ORJSONResponse)\nasync def read_items():\n    return ORJSONResponse([{\"item_id\": \"Foo\"}])",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=HTMLResponse)\nasync def read_items():\n    return \"\"\"\n    <html>\n        <head>\n            <title>Some HTML in here</title>\n        </head>\n        <body>\n            <h1>Look ma! HTML!</h1>\n        </body>\n    </html>\n    \"\"\"",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items():\n    html_content = \"\"\"\n    <html>\n        <head>\n            <title>Some HTML in here</title>\n        </head>\n        <body>\n            <h1>Look ma! HTML!</h1>\n        </body>\n    </html>\n    \"\"\"\n    return HTMLResponse(content=html_content, status_code=200)",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\ndef generate_html_response():\n    html_content = \"\"\"\n    <html>\n        <head>\n            <title>Some HTML in here</title>\n        </head>\n        <body>\n            <h1>Look ma! HTML!</h1>\n        </body>\n    </html>\n    \"\"\"\n    return HTMLResponse(content=html_content, status_code=200)\n\n\n@app.get(\"/items/\", response_class=HTMLResponse)\nasync def read_items():\n    return generate_html_response()",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI, Response\n\napp = FastAPI()\n\n\n@app.get(\"/legacy/\")\ndef get_legacy_data():\n    data = \"\"\"<?xml version=\"1.0\"?>\n    <shampoo>\n    <Header>\n        Apply shampoo here.\n    </Header>\n    <Body>\n        You'll have to use soap here.\n    </Body>\n    </shampoo>\n    \"\"\"\n    return Response(content=data, media_type=\"application/xml\")",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import PlainTextResponse\n\napp = FastAPI()\n\n\n@app.get(\"/\", response_class=PlainTextResponse)\nasync def main():\n    return \"Hello World\"",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import UJSONResponse\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=UJSONResponse)\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import RedirectResponse\n\napp = FastAPI()\n\n\n@app.get(\"/typer\")\nasync def redirect_typer():\n    return RedirectResponse(\"https://typer.tiangolo.com\")",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import RedirectResponse\n\napp = FastAPI()\n\n\n@app.get(\"/fastapi\", response_class=RedirectResponse)\nasync def redirect_fastapi():\n    return \"https://fastapi.tiangolo.com\"",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import RedirectResponse\n\napp = FastAPI()\n\n\n@app.get(\"/pydantic\", response_class=RedirectResponse, status_code=302)\nasync def redirect_pydantic():\n    return \"https://docs.pydantic.dev/\"",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\n\napp = FastAPI()\n\n\nasync def fake_video_streamer():\n    for i in range(10):\n        yield b\"some fake video bytes\"\n\n\n@app.get(\"/\")\nasync def main():\n    return StreamingResponse(fake_video_streamer())",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\n\nsome_file_path = \"large-video-file.mp4\"\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef main():\n    def iterfile():  # (1)\n        with open(some_file_path, mode=\"rb\") as file_like:  # (2)\n            yield from file_like  # (3)\n\n    return StreamingResponse(iterfile(), media_type=\"video/mp4\")",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import FileResponse\n\nsome_file_path = \"large-video-file.mp4\"\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def main():\n    return FileResponse(some_file_path)",
      "language": "python"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import FileResponse\n\nsome_file_path = \"large-video-file.mp4\"\napp = FastAPI()\n\n\n@app.get(\"/\", response_class=FileResponse)\nasync def main():\n    return some_file_path",
      "language": "python"
    },
    {
      "code": "from typing import Any\n\nimport orjson\nfrom fastapi import FastAPI, Response\n\napp = FastAPI()\n\n\nclass CustomORJSONResponse(Response):\n    media_type = \"application/json\"\n\n    def render(self, content: Any) -> bytes:\n        assert orjson is not None, \"orjson must be installed\"\n        return orjson.dumps(content, option=orjson.OPT_INDENT_2)\n\n\n@app.get(\"/\", response_class=CustomORJSONResponse)\nasync def main():\n    return {\"message\": \"Hello World\"}",
      "language": "python"
    },
    {
      "code": "{\"message\": \"Hello World\"}",
      "language": "unknown"
    },
    {
      "code": "{\n  \"message\": \"Hello World\"\n}",
      "language": "unknown"
    },
    {
      "code": "from fastapi import FastAPI\nfrom fastapi.responses import ORJSONResponse\n\napp = FastAPI(default_response_class=ORJSONResponse)\n\n\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]",
      "language": "python"
    }
  ],
  "patterns": [],
  "links": [
    "https://fastapi.tiangolo.com/advanced/custom-response/",
    "https://fastapi.tiangolo.com/advanced/response-directly/",
    "https://fastapi.tiangolo.com/tutorial/encoder/",
    "https://fastapi.tiangolo.com/advanced/additional-responses/"
  ]
}